\section{An Algorithm for Ring Loading}
\label{sec:ring-loading}

In this section, we see how we can transform the real-valued routing $\Phi$ determined by \cref{algo:rrl} into a binary routing that approximates the optimal routing.
Let $L_i = L_i(\Phi)$ be the edges loads induced by $\Phi$ and $S$ be the set of demands that are split.
In order to obtain a binary routing, we simply have to reroute the demands in $S$ all front or all back -- ideally without increasing the maximal edge load by too much. 
As we have seen, all demands in $S$ are mutually crossing and $\abs{S} \leq \lfloor \frac{n}{2} \rfloor$.
That means, each node is an endpoint of at most one demand.
For simplicity, we remove all nodes $i \in [n]$ that are not endpoints of any demand.
When rerouting any split demand, the loads on the two edges incident to $i$ change by the same amount.
Hence, we replace the edges $\{i-1, i\}$ and $\{i, i+1\}$ with a single new edge $\{i', i'+1\}$ and set 
\begin{equation}
	L_{i'} \coloneqq \max(L_{i-1}, L_i) \ .
\end{equation}
For rerouting the split demands, it suffices to consider this contracted instance $I'$ of size $2m$, where $m \coloneqq \abs{S}$.
We can rewrite $S$ in a simpler way as $S' = \{d_{i, i+m}\ |\ i \in [m]\}$.

For all $d_{i, i+m} \in S'$, let $x_i$, $y_i$ be the amount of traffic of $d_{i, i+m}$ that $\Phi$ routes through the front and the back, respectively.
Rerouting $d_{i, i+m}$, e.g. by routing it all front increases the the edge loads on the front route of $d_{i, i+m}$ by $y_i$, while those on the back route are decreased by $y_i$.
Similarly, routing $d_{i, i+m}$ all back increases the loads on the back route and decreases those in the front by $x_i$, respectively.

Now, assume that all demands in $S'$ have been routed either all front or all back.
For each $d_{i, i+m} \in S'$ we define
\begin{equation}
	z_i = \begin{cases}
		y_i, &\text{if } d_{i, i+m} \text{ is routed all front} \\
		-x_i, &\text{if } d_{i, i+m} \text{ is routed all back}
	\end{cases} \ ,
\end{equation}
that is, $z_i$ is the change of traffic on front route of $d_{i, j}$.
This allows us to formulate the total change of traffic on any edge $\{k, k+1\}$, $k \in [2m]$ and determine the new link load $L_k'$:
\begin{equation}
	\label{eq:load-change}
	L_k' = L_k + \sum_{i \in [m], k \in [i, i+m)} z_i - \sum_{i \in [m], k \notin [i, i+m)} y_i \ .
\end{equation}
Here, we have $k \in [i, i+m)$ if and only if the edge $\{k,k+1\}$ lies on the front route of $d_{i, i+m}$.


The following theorem shows that there is a way to reroute the demands in $S'$ such that the maximal edge load remains bounded.
\begin{lemma}
	Let $x_i, y_i \in \R_{\geq 0}, i \in [m]$ be such that $x_i + y_i \leq D$ for $D \in \R_{\geq 0}$.
	Then there exist $z_i \in \R$, $i \in [m]$ such that:
	\begin{align}
		(z_i = y_i \quad \text{ or } \quad z_i = -x_i) 
		\quad \text{ and } \quad \sum_{i=1}^k z_i \in \left[-\frac{D}{2}, \frac{D}{2}\right] \quad \forall k \in [m] \ .
	\end{align}
\end{lemma}
\begin{proof}
	We iteratively define the $z_i$.
	Set $z_1 \coloneqq y_1$.
	Then, for $k \in [n]$, let $z_i, 1 \leq i < k$ be such that $\sum_{i=1}^{k-1} z_i \in \left[-\frac{D}{2}, \frac{D}{2}\right]$.
	Since $x_k + y_k \leq D$, at least one of the inequalities $\sum_{i=1}^{k-1} z_i + y_k \leq \frac{D}{2}$, $\sum_{i=1}^{k-1} z_i - x_i \geq -\frac{D}{2}$ holds true.
	Choose $z_k = y_k$ or $z_k = -x_k$ accordingly.	
\end{proof}
\begin{theorem}
	\label{theo:ring-loading-algorithm}
	Let $\Phi$ be the routing obtained from \cref{algo:rrl} and $L^\mathrm{opt}$ be the ringload of an optimal binary routing.
	Then the demands that are split by $\Phi$ can be rerouted such that the resulting binary routing $\Phi'$ has a ringload of
	\begin{equation}
		L(\Phi') \leq L^\mathrm{opt} + \frac{3}{2}D \ ,
	\end{equation}
	where $D = \max_{1 \leq i < j \leq n} d_{i, j}$ is the largest demand.
\end{theorem}
\begin{proof}
	
\end{proof}

\begin{corollary}
	Let $I$ be an instance of \RL with optimal (binary) ringload $L^\mathrm{opt}$.
	Then \cref{algo:rrl} and the technique in 
\end{corollary}


The idea for solving an instance of \RL is the following:
First, we compute a solution to the same instance in \RRL.
As \cref{lemma:number-of-split-demands} states, \cref{algo:rrl} yields a solution $\phi$ in which at most $\lfloor\frac{n}{2}\rfloor$ demands are split; the remainder is either routed all front or all back.
Now, we iteratively unsplit those demands.
Of course, this does not always yield the optimal solution $L^\mathrm{opt}$ to the ring loading instance.
However, the way in which we unsplit the demands approximates $L^\mathrm{opt}$ with an additive error of at most $\frac{3}{2}D$, where $D$ is the largest demand.

The procedure for unsplitting is given in \cref{algo:rl}.

\input{figures/rl_algorithm}

