\section{An Algorithm for Relaxed Ring Loading}

\begin{definition}
	An optimal solution $\phi^\ast$ to \RRL is said to be \emph{minimal} if for every other optimal there exists at least one $1 \leq i \leq n$ for which $L_i' > L_i^\ast$.
\end{definition}
This definition is equivalent for a minimal solution $\phi^\ast$ there exists no other optimal solution with $L_i' \leq L_i^\ast$ for all $1 \leq i \leq n$ and $L_j' < L_j^\ast$ for at least one $j$.

If a routing $\phi^\ast$ routes traffic of the demand $d_{ij}$ through the front and the back route, that is if $\phi^\ast$ $\phi^\ast(i, j) \in (0, 1)$, we say that $\phi^\ast$is \emph{splits} the demand $d_{ij}$.

\begin{theorem}
	\label{theo:parallel-demands-non-crossing}
	Let $\phi^\ast$ be a minimal solution to an instance of \RRL.
	Then no link in between two parallel demands $d_{ij}$ and $d_{gh}$ carries traffic from both demands.
\end{theorem}
\begin{proof}
	Let $\phi^\ast$ be a minimal solution.
	Assume that the link $\{k, k+1\}$ lies in between the demands $d_{ij}$ and $d_{gh}$ and that $\phi^\ast$ routes traffic from both demands through $\{k, k+1\}$.
	Let $\alpha$ and $\beta$ be the amounts of traffic from $d_{ij}$ and $d_{gh}$, respectively, that is routed through $\{k, k+1\}$.
	Furthermore, assume without loss of generality that $\alpha \leq \beta$.
	We now construct a new routing $\phi'$ from $\phi^\ast$ by rerouting traffic $\alpha$ of both demands such that it no longer passes through $\{k, k+1\}$.
	\Todo{Explain the cases how parallel demands can occur, and when \{k, k+1\} must lie on the back and when on the front route}
	Then $\{k, k+1\}$ no longer carries traffic from $d_{ij}$ and the new load on this link is $L_k' = L_k^\ast - 2 \alpha < L_k^\ast$.
	
	\input{figures/parallel_demands}
	
	Parallel demands can occur in three types of configurations, which can be seen in \cref{fig:parallel-demands}.
	We distinguish the three cases:
	\begin{enumerate}[align=left]
		\item[\textbf{Cases 1 and 2:} $[i, j) \subset [g, h)$ or $[g, h) \subset [i,j)$]{\mbox{}\\
			We assume $[i, j) \subset [g, h)$; the other case is reasoned analogously.
			Then the rerouting of the traffic results $\phi'$ given by
			\begin{align}
				\phi'(i, j) = 1 \ ,\quad
				\phi'(g, h) = \frac{\beta - \alpha}{d_{gh}}
			\end{align}
			and $\phi'(u, v) = \phi^\ast(u, v)$ for all other demands $d_{uv}$.
			For all $1 \leq m \leq n$, the new link loads are given by
			\begin{equation}
				L_m' = L_m^\ast + \alpha (\dOne_{\{m \in [i, j)\}} - \dOne_{\{m \notin [i, j)\}} + 
				\dOne_{\{m \notin [g, h)\}} - \dOne_{\{m \in [g, h)\}}) \ ,
			\end{equation}
			$\dOne$ being the indicator function.
			If $m \in [i, j)$, then $m \in [g, h)$ and $L_m' = L_m^\ast$.
			If $m \notin [i, j)$, then  $L_m' \leq L_m^\ast$.
		}
		\item[\textbf{Case 3:} $[i, j) \cap [g, h) = \emptyset$]{\mbox{}\\
			In this case the routing $\phi'$ is given by
			\Todo{Explain where this comes from}
			\begin{align}
				\phi'(i, j) = 1 \ ,\quad
				\phi'(g, h) = 1 - \frac{\beta - \alpha}{d_{gh}}
			\end{align}
			and $\phi'(u, v) = \phi^\ast(u, v)$ for all other demands $d_{uv}$.
			The new link loads are given by
			\begin{equation}
				L_m' = L_m^\ast + \alpha (\dOne_{\{m \in [i, j)\}} - \dOne_{\{m \notin [i, j)\}} + 
				\dOne_{\{m \in [g, h)\}} - \dOne_{\{m \notin [g, h)\}}) \ .
			\end{equation}
			Similar to the cases 1 and 2, we get $L_m' \leq L_m^\ast$, as we assumed that $[i, j) \cap [g, h) = \emptyset$.
		}
	\end{enumerate}
	In total, the routing $\phi'$ has link loads $L_m' \leq L_m^\ast$ for all $1 \leq m \leq n$ and $L_k' < L_k^\ast$.
	This contradicts the minimality of $\phi^\ast$.
\end{proof}

We can imagine a cut $\{i, j\}$ as a chord connecting the link $\{i, i+1\}$ with the link $\{j, j+1\}$ and can therefore also use the same terms to describe their properties as for demands, such as \emph{crossing} and \emph{parallel}.

\begin{definition}
	The \emph{demand across the cut} $\{g, h\}$ with $g \neq h$ is the sum of demands with endpoints on both sides of the cut:
	\begin{equation}
		\label{eq:cut-demand-definition}
		D_{gh} \coloneqq \sum_{d_{ij} \in \{d_{ij}\ |\ \abs{[i, j) \cap (g, h]} = 1\}} \ .
	\end{equation}
	For the degenerate cuts $\{g, g\}$ we define $D_{gg} \coloneqq 2 C_g$.
\end{definition}

\begin{definition}[Cut Condition]
	An cut $\{g, h\}$ is said to satisfy the \emph{cut condition} if
	\begin{equation}
		D_{gh} \leq C_g + C_h \ .
	\end{equation}
	An instance $I$ \emph{satisfies the cut condition} if each cut does.
	$C_g + C_h - D_{gh}$ is called the \emph{slack} of the cut $\{g, h\}$.
\end{definition}
In an instance of \RRL, is there is a cut $\{g, h\}$ which violates the cut condition, the instance is not solvable:
The links $\{g, g+1\}$ and $\{h, h+1\}$ pose a bottleneck to the demands that cross the cut and hinder every demand from being satisfied.

\begin{theorem}
	\label{theo:cut-condition}
	Let $I$ be an instance of \RRL that satisfies the cut condition.
	Then $I$ is solvable.
\end{theorem}
For the proof, we will need the following lemma:
\begin{lemma}
	\label{lemma:parallel-diagonal-cuts}
	Let $\{g, h\}$, $\{g', h'\}$ be two parallel cuts.
	Then every demand crosses as many of the cuts $\{g, h\}$, $\{g', h'\}$ as it crosses cuts $\{g, g'\}, \{h, h'\}$
\end{lemma}
\begin{proof}
	By distinction of cases.
\end{proof}
\begin{proof}[Proof of \cref{theo:cut-condition}]
	We conduct the proof by assuming there are instances that satisfy the cut condition, but are not solvable.
	Let $I$ be the smallest of these instances in terms of ring size $n$ and the number of non-zero demands.
	
	We now construct another non-solvable instance $I'$ with one less non-zero demand and show that this instance still satisfies the cut condition.
	This will contradict the minimality of $I$, implying that no such instance exists.
	
 	We begin by picking any non-zero demand $d_{ij}$ with $j - i \geq 2$.
	
	If none exists, all non-zero demands in $I$ must be of the form $d_{i, i+1}$.
%	Then neither of these demands can be routed through the front route, that is the link $\{i, i+1\}$, as otherwise we could construct an instance with one less non-zero demand by pretending to route that demand through the front and decreasing the capacity of the link $\{i, i+1\}$ accordingly.
%	This would contradict the minimality of $I$.
%	Hence, the only possibility is to route all demands through the back route, let $\phi$ be that routing.
%	Doing this, for all $1 \leq k \leq n$ the link loads are given as
%	\begin{equation}
%		% All is routed through the back
%		L_k = \sum_{\{d_{ij}\ |\ k \notin [i, j)\}} d_{ij} \leq D_{kl} \leq C_k + C_l \quad \forall l\neq k \ .
%	\end{equation}
%	This means that $\phi$ solves $I$, contradicting the non-feasibility of $I$. 
	Pick any such demand $d_{i, i+1}$ of which there must be at least one, as otherwise any routing solves $I$.
	Then, renumber the nodes and links by "rotating" such that $d_{i, i+1}$ corresponds to $d_{1, n}$ in the renumbered instance, which still satisfies minimality in the above sense.
	Continue with the new instance in which it is possible to pick a non-zero demand $d_{ij}$ with $j - i \geq 2$, as $n \geq 4$.
	
	Hence, we have a non-zero demand with $j - i \geq 2$. 
	Let $\{g, h\}$ be a cut with minimal slack $M$ along the front route of $d_{ij}$, that is a cut $\{g, h\}$ with $i \leq g < h < j$ that minimizes $C_g + C_h - D_{gh}$.
	We construct a new instance $I'$ by pretending to route $\frac{M}{2}$ traffic of $d_{ij}$ along the front route and the remaining $d_{ij} - \frac{M}{2}$ along the back route.
	We set the capacities of the new instance accordingly, that is $C_k' = C_k - \frac{M}{2}$ for links on the front route and $C_k' = C_k - (d_{ij} - \frac{M}{2})$ on the back route.
	The demands remain the same with the exception of $d_{ij}$, which is now $0$.
	It is easy to see that the new instance is still not solvable; otherwise we could use any feasible routing for $I'$ to construct a solution to $I$.
	
	By construction, all cuts $\{s, t\}$ in $I'$ that lie on the front route of $d_{ij}$, that is $i \leq s < t < j$, still satisfy the cut condition:
	\begin{equation}
		D_{st}' = D_{st} \leq C_{s} + C_{t} - M = (C_{s} - \frac{M}{2}) + (C_{t} - \frac{M}{2}) \stackrel{\mathrm{Def.}}{=} C_{s}' + C_{t}' \ .
	\end{equation}
	The first equality follows from the fact that $d_{ij}$ does not contribute to $D_{st}$ and $D_{st}'$, the inequality from the choice of $M$.
	Similarly, all cuts $\{s, t\}$ that $d_{ij}$ crosses satisfy the cut condition.
	Assume $s \notin [i, j), t \in [i, j)$ without loss of generality, then the following holds true:
	\begin{equation}
		D_{st}' = D_{st} - d_{ij} \leq C_s + C_t - d_{ij} = \left(C_s - \left(d_{ij} - \frac{M}{2}\right)\right) + \left(C_h - \left(d_{ij} - \frac{M}{2}\right)\right) \stackrel{\mathrm{Def.}}{=} C_s' + C_t' \ .
	\end{equation}
	Here, the first equality results from $d_{ij}$ no longer contributing to the demand of cuts which it crosses.
	The inequality is simply the cut condition in $I$.
	
	Now, pick any cut $\{s, t\}$ which lies on the back route of $d_{ij}$ and assume it violates the cut condition.
	This means that
	\begin{equation}
		D_{st} = D_{st}' > C_s' + C_h' \stackrel{\mathrm{Def.}}{=} \left(C_s - \left(d_{ij} - \frac{M}{2}\right)\right) + \left(C_h - \left(d_{ij} - \frac{M}{2}\right)\right)
	\end{equation}
	or equivalently $D_{st} +  2(d_{ij} - \frac{M}{2}) > C_s + C_h$.
	This, the choice of $M$ and \cref{lemma:parallel-diagonal-cuts} implies that
	\begin{align}
		D_{sg} + D_{th} &\geq D_{gh} + D_{st} + 2 d_{ij}\\
		&> (C_g + C_h - M) +  \left(C_s - \left(d_{ij} - \frac{M}{2}\right)\right) + \left(C_h - \left(d_{ij} - \frac{M}{2}\right)\right) + 2 d_{ij}\\
		&= C_g + C_h + C_s + C_t \ .
	\end{align}
%	In the inequality we further used the fact that $D_{gh} = C_g + C_h - M$.
	In total, this means that $D_{sg} > C_s + C_g$ or $D_{th} > C_t + C_h$, showing that at least one of the cuts $\{s, g\}$, $\{t, h\}$ has violated the cut condition in $I$; a contradiction.
	
	Thus all cuts in the new instance $I'$ satisfy the cut condition.
	This contradicts the minimality of $I$ which shows that no such instance can exist.
\end{proof}

As we have seen, \RRL can be formulated as a linear program and thus be solved as such.
This can be done e.g. using XXYYs algorithm, which requires $\cO(??)$ time in our application.
There is, however, another method which is significantly faster.
The method is described in \cref{algo:rrl}


\input{figures/rll_algorithm}

\input{figures/demand_cuts_algorithm}

\begin{align}
	M &\coloneqq \max_{1 \leq i < j \leq n} D_{ij}\\
	\label{eq:minimal-capacities}
	C_i &\coloneqq \max \left(\max_{1 \leq j < i}(D_{ji} - C_j), \max_{i < j \leq n}(D_{ij} - \frac{M}{2})\right)
\end{align}

\begin{lemma}
	\label{lemma:capacities-bounded}
	Let $I$ be an instance of \RRL and let the capacities $C_i$ be defined as in \cref{eq:minimal-capacities}.
	Then $C_i \leq \frac{M}{2}$ for all $1 \leq i \leq n$.
\end{lemma}
\begin{proof}
	We conduct the proof by induction over $i$. 
	The beginning $i=1$ is covered in Case 2 below. 
	Thus, Let $2 \leq i \leq n$.
	We distinguish two cases:
	\begin{enumerate}[align=left]
		\item[Case 1: $C_i = \max_{1 \leq j < i}(D_{ji} - C_j)$]{\mbox{}\\
			Then there exists some $1 \leq j < i$ for which we have
			\begin{align}
				C_i &= D_{ji} - C_j \\
				&\stackrel{\mathrm{IH}}{\leq} D_{ji} - \left(\max_{j < k \leq n} D_{jk} - \frac{M}{2}\right)\\
				&= (D_{ji} - \max_{j < k \leq n} D_{jk}) + \frac{M}{2} \ .
			\end{align}
			Because of $j < i$ we have $D_{ji} - \max_{j < k \leq n} D_{jk} < 0$, proving that $C_i \leq \frac{M}{2}$.
		}
		\item[Case 2: $C_i = \max_{i < j \leq n}(D_{ij} - \frac{M}{2})$]{\mbox{}\\
			Then it immediately follows from the choice of $M$ that $C_i \leq M - \frac{M}{2} = \frac{M}{2}$.
		}
	\end{enumerate}
\end{proof}

\begin{lemma}
	\label{lemma:minimal-solution}
	Let $I$ be an instance of \RRL.
	Let $M \coloneqq \max_{1 \leq i < j \leq n} D_{ij}$ and let $C_i$ be such as to satisfy $C_i = \max \left(\max_{1 \leq j < i}(D_{ji} - C_j), \max_{i < j \leq n}(D_{ij} - \frac{M}{2})\right)$ for all $1 \leq i \leq n$.
	Then any routing $\phi$ for $I$ which does not violate the capacities $C_i$ is minimal with ring load $L = \frac{M}{2}$.
\end{lemma}
\begin{proof}
	Let $\{g, h\}$ be the cut for which the maximum $M$ is attained.
	Then in any feasible routing, at least $\frac{M}{2}$ traffic must be routed through either of the links $\{g, g+1\}$, $\{h, h+1\}$, implying that $L \geq \frac{M}{2}$.
	However, the instance $I$ together with the capacities $C_i = \frac{M}{2}$ for all $1 \leq i \leq n$ satisfies the cut constraint.
	It follows from \cref{theo:cut-condition} that a solution exists, which by construction has a ring load $L \leq \frac{M}{2}$.
	Together we get $L = \frac{M}{2}$.
	
	The capacities $C_i$ are such that $I$ satisfies the cut condition:
	For $1 \leq i < j \leq n$ we have
	\begin{equation}
		C_j = \max \left(\max_{1 \leq k < j}(D_{kj} - C_k), \max_{j < k \leq n}(D_{jk} - \frac{M}{2})\right) \geq D_{ij} - C_i \ ,
	\end{equation}
	which implies $D_{ij} \leq C_i + C_j$.
	Thence by \cref{theo:cut-condition} there exists a solution to $I$ which does not violate the link capacities.
	Let $\phi$ such a routing with link loads $L_i$.
	We now show that $\phi$ is minimal by contraposition.
	
	Therefore, assume that $\phi$ is not minimal and let $\phi'$ with link loads $L_i'$ be a witness.
	We define new capacities $C_i' \coloneqq L_i'$ for all $1 \leq i \leq n$.
	Especially, we have $C_i' \leq C_i$ for all $i$ and $C_k' < C_k$ for at least one $k$.
	Let $j$ be the smallest index for which $C_j' < C_j$.
	We now show that there is a cut $\{j, l\}$ which violates the cut condition for the capacities $C_i'$ by distinguishing the two possible cases:
	\begin{enumerate}[align=left]
		\item[Case 1: $C_j = \max_{1 \leq k < j}(D_{kj} - C_k)$]{\mbox{}\\
			The we especially have $C_j' < C_j = \max_{1 \leq k < j}(D_{kj} - C_k)$ and by the choice of $j$ as the smallest index $C_i' = C_i$ for all $1 \leq i < j$.
			This means that there exists a $1 \leq k \leq j$ such that $C_j' < D_{kj} - C_k = C_j' < D_{kj} - C_k'$, implying that $D_{kj} > C_k' + C_j'$.
			Thus, the cut $\{k, j\}$ is violated.
		}
		\item[Case 2: $C_j = \max_{j < k \leq n}(D_{jk} - \frac{M}{2})$]{\mbox{}\\
			Then $C_j' < C_j = \max_{j < k \leq n}(D_{jk} - \frac{M}{2})$.
			This means that there exists a $j < k \leq n$ such that $C_j' < D_{jk} - \frac{M}{2}$.
			Using \cref{lemma:capacities-bounded} we then get 
			\begin{equation}
				C_j' + C_k' \leq C_j' + C_k \leq C_j' + \frac{M}{2} < D_{jk} \ ,
			\end{equation}
			again showing that the cut $\{k, j\}$ is violated.
		}
	\end{enumerate}
	In total this shows that the instance $I'$ with capacities $C_i'$ does not satisfy the cut condition.
	Thus there exists no witness $\phi'$, proving that $\phi$ already was minimal.
\end{proof}

The following theorem guarantees that the algorithm works correctly.
\begin{theorem}
	\label{theo:rll-algo-correct}
	Let $I$ be an instance of size $n$ of \RRL that satisfies the cut condition.
	Then \cref{algo:rrl} computes a minimal solution of $I$ in $\cO(n^2)$ time using $\cO(?)$ space.
\end{theorem}
\begin{proof}
	Computing the $\binom{n}{2}$ values $D_{ij}$ can be done in $\cO(n^4)$ time in the obvious way, using the formula in \cref{eq:cut-demand-definition}.
	However, there exists a more efficient way which is described in \cref{algo:demands-across-cuts}.
	This improved algorithm completes the task in $\cO(n^2)$, which is optimal (it already takes $\Omega(n^2)$ time to read the $\binom{n}{2}$ inputs $d_{ij}$).
	This subroutine is based on the following recursion:
	\Todo{Maybe add proper proof if there is space, otherwise explain basic idea in one sentence.}
	\begin{equation}
		D_{i, j} = \begin{cases}
			\sum_{k < i+1} d_{k,i+1} + \sum_{k > i+1} d_{i+1, k}, & \text{if } j = i+1 \\
			D_{i, i+1} + D_{i+1, j} - A_{i+1, j}, & \text{if } j > i+1
		\end{cases}
	\end{equation}
	in which we used the auxiliary variable
	\begin{equation}
		A_{i, j} \coloneqq \begin{cases}
				d_{i, i+1}, & \text{if } j = i+1\\
				A_{i, j-1} + d_{i, j}, &\text{if } j > i+1\\
		\end{cases}
	\end{equation}
	Applying the maximum operator to the $\binom{n}{2}$ values $D_{ij}$ also takes $\cO(n^2)$ time.
	
	The computation of the capacities $C_i$ can be carried out in $\cO(n^2)$ time:
	Each iteration of the for-loop takes time linear in $n$, as the maximum of at most $n$ values is taken.
	
	For the correctness we just have to understand that the algorithm does indeed compute a solution $\phi$ which does not violate the capacities $C_i$.
	\cref{lemma:minimal-solution} then guarantees the minimality of the solution.
	
	
\end{proof}

\begin{lemma}
	At the beginning of the while-loop in \cref{algo:rrl}, for every $i \in [n]$ there exists a $j \neq i$ such that $\{i, j\}$ is a tight cut.
\end{lemma}
\begin{proof}
	Assume the contrary, that is there is an $i \in [n]$ which is not part of any tight cut.
	Let $M \coloneqq \min_{j \neq i} C_i + C_j - D_{ij}$.
	Then $M > 0$ by assumption.
	Define $C_i' = C_i - M$ and $C_j' = C_j$ for all $j \neq i$.
	Then every cut still satisfies the cut condition.
	But in the proof of \cref{lemma:minimal-solution} we showed that no such set of capacities can exist.
\end{proof}

\begin{lemma}
	Once a cut becomes tight in \cref{algo:rrl}, it remains tight.
\end{lemma}
\begin{proof}
	There are two points in \cref{algo:rrl} where the slack of a cut can change:
	When the capacities are decreased and when the $D_{ij}$ change.
	First, note that decreasing the capacities can only decrease slack.
	This cannot un-tighten any cut.
	Second, when any $D_{ij}$ changes it must be due to a crossing demand $d_{gh}$ being routed either way.
	This means that the new demand across the cut is $D_{ij}' = D_{ij} - d_{gh}$.
	However, in this case the capacity of either $\{i, i+1\}$ or $\{j, j+1\}$ is also decreased by $d_{gh}$, meaning that
	$C_i' + C_j' = C_i + C_j - d_{gh}$.
	In total we get $C_i' + C_j' - D_{ij}' = C_i + C_j - D_{ij}$, showing that the slack does not change.
\end{proof}

\begin{lemma}
	Let $d_{ij}$ be a demand and $\{u, v\}$ a tight cut that is parallel to $d_{ij}$.
	Then $d_{ij}$ must be routed to miss the cut.
\end{lemma}
\begin{proof}
	In any solution, all demands that cross the cut $\{u, v\}$ must route their traffic through $\{u, u+1\}$ or $\{v, v+1\}$ (or both).
	The sum of all such demands is just $D_{uv} = C_u + C_v$, which means that these demands already saturate both $\{u, u+1\}$ and $\{v, v+1\}$.
	This implies that no other demand can be routed through those links. 
\end{proof}

\begin{lemma}
	\label{lemma:number-of-split-demands}
	At the end of \cref{algo:rrl} at most $\lfloor\frac{n}{2}\rfloor$ demands are split.
\end{lemma}
\begin{proof}
	Let $\phi^\ast$ be the minimal routing that results from the execution of \cref{algo:rrl}.
	Furthermore, let $S \coloneqq \{(i, j)\ |\ d_{ij}\ \text{is split by}\ \phi^\ast \}$ and $(i, j), (g, h) \in S$.
	If the demands $d_{ij}$ and $d_{gh}$ were parallel, there would be a link $\{k, k+1\}$ that carries traffic from both demands, as they are both split.
	However, it follows from the minimality of $\phi^\ast$ and \cref{theo:parallel-demands-non-crossing} that this cannot be the case, which implies that $d_{ij}$ and $d_{gh}$ are crossing.
	This can, by definition, only occur if $i, j, g, h$ are mutually distinct.
	
	This implies that every $1 \leq i \leq n$ can occur in at most one tuple in $S$.
	As the tuples in $S$ each consist of two elements, there can be at most $\lfloor\frac{n}{2}\rfloor$ such tuples.
\end{proof}

\subsection{Correctness}

\subsection{Runtime}


\begin{proof}
\end{proof}